# 📅 项目路线图 (Project Roadmap)

**创建时间**: 2026-01-22  
**最后更新**: 2026-01-22  
**状态**: 🟢 进行中 (In Progress)

---

## 📋 文档说明

本文档记录项目的里程碑、待办事项和架构演进计划。  
**格式规范**: 使用 `- [ ]` 表示待办，`- [x]` 表示已完成，`~~删除线~~` 表示废弃。

---

## 🎯 项目愿景 (Vision)

打造一款基于 STM32F405 的高性能、开源、易扩展的四轴飞行控制器，支持 GPS 定点、光流悬停和 OSD 显示，适用于教育和科研。

---

## ✅ Phase 1: 基础飞行 (Basic Flight) [已完成]

**目标**: 实现基本的姿态稳定和定高飞行

- [x] 硬件驱动开发
  - [x] MPU6050 IMU 驱动 (I2C DMA)
  - [x] SPL06 气压计驱动
  - [x] SBUS 遥控器接收 (UART4 DMA)
  - [x] 电机 PWM 输出 (TIM8, 400Hz)
- [x] 姿态解算
  - [x] Mahony 互补滤波算法 (500Hz)
  - [x] 四元数转欧拉角
  - [x] 陀螺仪零漂校准
- [x] 姿态控制
  - [x] 串级 PID 控制器 (角度环 + 角速度环)
  - [x] 电机混控算法 (X 型四轴)
  - [x] Airmode 怠速保护
- [x] 基础定高
  - [x] 气压计高度解算
  - [x] 高度环 PID 控制
  - [x] 油门曲线映射

---

## ✅ Phase 2: 进阶功能 (Advanced Features) [已完成]

**目标**: 实现室内外定位和 FPV 显示

- [x] 光流定位
  - [x] LC302 光流模块驱动
  - [x] 光流数据高度补偿
  - [x] 位置环 PID 控制
- [x] GPS 导航
  - [x] ATGM336H GPS 驱动 (USART2 DMA)
  - [x] NMEA 协议解析 (GNGGA, GNRMC)
  - [x] GPS 坐标转 XY 平面坐标
  - [x] GPS 位置环 PID 控制
- [x] OSD 显示
  - [x] AT7456E 驱动 (SPI1)
  - [x] 飞行模式显示
  - [x] 姿态/电压/GPS 状态显示
- [x] 磁力计集成
  - [x] QMC5883L 驱动 (I2C2)
  - [x] 8 字校准算法
  - [x] 倾斜补偿航向计算
- [x] 参数存储
  - [x] W25Q128 Flash 驱动 (SPI1)
  - [x] 双缓冲区参数存储
  - [x] CRC16 校验
- [x] 上位机通信
  - [x] 匿名上位机 V7 协议
  - [x] 实时数据上传
  - [x] PID 参数在线调整

---

## 🚧 Phase 3: 智能化与优化 (Intelligence & Optimization) [进行中]

**目标**: 提升飞行性能和安全性

### 3.1 安全强化 (Safety Hardening)
- [x] 异步日志系统 (RingBuffer + DMA)
- [x] 移除高频任务中的阻塞式 printf
- [ ] 失控保护 (Failsafe) 逻辑升级
  - [ ] Stage 1: 信号丢失 < 1s → 保持姿态
  - [ ] Stage 2: 信号丢失 > 1s → 自稳模式 + 降落油门
  - [ ] Stage 3: 信号丢失 > 5s → 强制停机
- [ ] 解锁前 GPS 强制检查 (Arming Check)
- [ ] 磁力计电流补偿集成

### 3.2 算法优化 (Algorithm Optimization)
- [ ] D 项滤波参数优化 (30Hz → 40Hz 可选)
- [ ] 积分抗饱和 (Anti-Windup) 条件积分
- [ ] ~~EKF 状态估计~~ (暂缓，算力不足)

### 3.3 功能扩展 (Feature Extension)
- [ ] 航点飞行 (Waypoint Mission)
- [ ] 自动返航 (RTH)
- [ ] 视觉避障 (配合树莓派)
- [ ] WS2812 RGB 灯效

---

## 📋 Phase 4: 硬件设计 (Hardware Design) [待开始]

**目标**: 完成 PCB 设计和打样验证

### 4.1 原理图设计
- [ ] 电源管理模块
  - [ ] SY8303 DCDC 降压 (5V BEC)
  - [ ] RT9193 LDO (3.3V)
  - [ ] 软开关电路
  - [ ] USB 反灌保护
- [ ] MCU 最小系统
  - [ ] STM32F405RGT6 (LQFP-64)
  - [ ] 8MHz HSE 晶振
  - [ ] SWD 调试接口
- [ ] 传感器模块
  - [ ] MPU6050 + SPL06 (I2C1)
  - [ ] QMC5883L (I2C2)
- [ ] 接口设计
  - [ ] 电机输出 (SH1.0-3P × 4)
  - [ ] GPS 接口 (SH1.0-6P)
  - [ ] 光流接口 (SH1.0-4P)
  - [ ] SBUS 接口 (SH1.0-3P)
  - [ ] USB Type-C

### 4.2 PCB 布局
- [ ] 4 层板设计 (Top/GND/PWR/Bottom)
- [ ] 30.5mm × 30.5mm 标准尺寸
- [ ] M3 安装孔
- [ ] 电源完整性检查
- [ ] 信号完整性检查

### 4.3 打样验证
- [ ] 首版 PCB 打样
- [ ] 焊接与调试
- [ ] 功能验证
- [ ] 问题记录与改版

---

## 📋 Phase 5: 产品化 (Productization) [计划中]

**目标**: 完善文档和用户体验

- [ ] 用户手册编写
- [ ] 固件升级工具 (DFU)
- [ ] 配置工具 (PC 端)
- [ ] 开源发布 (GitHub)
- [ ] CSDN 博客教程

---

## 🗓️ 里程碑时间线 (Milestones)

| 阶段 | 目标 | 状态 | 完成日期 |
|------|------|------|----------|
| Phase 1 | 基础飞行 | ✅ 完成 | 2026-01-14 |
| Phase 2 | 进阶功能 | ✅ 完成 | 2026-01-18 |
| Phase 3 | 智能化优化 | 🚧 进行中 | - |
| Phase 4 | 硬件设计 | ⏳ 待开始 | - |
| Phase 5 | 产品化 | 📋 计划中 | - |

---

## 📝 废弃方案记录 (Deprecated Plans)

### ~~EKF 状态估计~~
- **废弃时间**: 2026-01-18
- **废弃原因**: STM32F405 算力不足，运行完整 EKF 会占用 60-80% CPU
- **替代方案**: 保留 Mahony 互补滤波，仅在高度环和位置环使用简化 EKF

### ~~STM32F407VGT6 方案~~
- **废弃时间**: 2026-01-16
- **废弃原因**: LQFP-100 封装过大，不适合 Mini 飞控
- **替代方案**: 迁移到 STM32F405RGT6 (LQFP-64)

---

## 📌 更新日志

| 日期 | 变更内容 | 责任人 |
|------|----------|--------|
| 2026-01-22 | 创建项目路线图文档 | Kilo Code |
| 2026-01-22 | 从 01_Project_Master_Plan.md 迁移内容 | Kilo Code |